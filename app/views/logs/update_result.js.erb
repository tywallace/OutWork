//On 'Log results' submit:

//Clear task header
$('#task-header').html('')
//clear counter
$("#counter").html('');
//Clear form, update display msg
$("#form-area").html('<h4 class="text-center text-info">Time for a break!</h4>');
//Update news feed
<% l = current_user.logs.last %>
if ($("#today").length == 0){
	$("#feed").prepend('<div class="row" id="today">\
							<div class="col-sm-4 col-sm-offset-4 text-center">\
								<p class="text-muted">Today</p>\
							</div>\
						</div>');
}

$('#today').after('<div class="feed-item" style="display: none;">\
						<div class="row">\
							<div class="col-sm-5 col-sm-offset-1">\
								<p class="text-muted"><%= l.created_at.strftime("%l:%M%P") %></p>\
								<p class="task-feed text-danger"><%= l.task %></p>\
							</div>\
							<div class="col-sm-5">\
								<p class="text-muted"><%= l.ended_at.strftime("%l:%M%P") %></p>\
								<p class="result-feed text-info"><%= l.result %></p>\
							</div>\
						</div>\
						<hr>\
					</div>');

$('.feed-item').first().delay('125').slideDown('slow');
//Start break timer
$('#break-timer').html('<h1>5:00</h1>', startBreakTimer());

 function playSound(filename){   
                document.getElementById("sound").innerHTML='<audio autoplay="autoplay"><source src="' + filename + '.mp3" type="audio/mpeg" /><source src="' + filename + '.ogg" type="audio/ogg" /><embed hidden="true" autostart="true" loop="false" src="' + filename +'.mp3" /></audio>';
            }

function startBreakTimer(){
	var stopButton = document.getElementById('stop');
	var time = 5;
	// var time = 2;
	var timer = setInterval(function(){
		time = decrement(time);
		var minutes = Math.floor(time / 60);
		var seconds = time % 60;
		if(time > 0)
		{
			createEndBreakForm();
		}
		if(time == 0)
		{
			clearInterval(timer);
			createStartWorkForm();
			playSound('https://outwork.s3.amazonaws.com/audio/notify');
		}
		$('#break-timer').html('<h1>'+(minutes.toString().length < 2 ? '0' + minutes : minutes) + ':' + (seconds.toString().length < 2 ? '0' + seconds : seconds)+'</h1>');
	}, 1000)

		stopButton.onclick = function() {
	        time = 0;
	        playSound('https://outwork.s3.amazonaws.com/audio/notify');
	    };
}


function endBreak(){
	time = 0;
	playSound('https://outwork.s3.amazonaws.com/audio/notify');
}

function decrement(seconds){
	return seconds - 1;
};

function createStartWorkForm(){
	$("#form-area").html('<h4 class="text-center">Break time is over!</h4>\
						<div class="row text-center" id="start">\
							<%= button_to "Start work", logs_start_work_path, remote: true, :form=> {:id =>"start"}, class: "btn btn-danger col-sm-4 col-sm-offset-4" %>\
						</div>');
}
function createEndBreakForm(){
  $("#form-area").html('<div class="row text-center" id="stop">\
				  			<%= button_to "End Break", logs_start_work_path, remote: true, class: "btn btn-danger col-sm-4 col-sm-offset-4" %>\
				        </div>');
}
